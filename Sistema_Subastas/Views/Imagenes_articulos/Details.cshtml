@model List<Sistema_Subastas.Models.imagenes_articulos>

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Styles {
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="/css/StyleE.css" />
}

<div class="volver-wrapper">
    <a asp-controller="Imagenes_articulos"
       asp-action="Index"
       class="btn-volver">
        ← Volver
    </a>
</div>

<div class="detalle-producto-wrapper">
    <div class="detalle-producto-contenido">
        <!-- Carrusel grande a la izquierda -->
        <div class="detalle-imagen">
            <div id="carouselArticulo" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-inner">
                    @for (int i = 0; i < Model.Count; i++)
                    {
                        <div class="carousel-item @(i == 0 ? "active" : "")">
                            <img src="@Model[i].url_imagen" class="imagen-principal" alt="Imagen del artículo" />
                        </div>
                    }
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#carouselArticulo" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon"></span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#carouselArticulo" data-bs-slide="next">
                    <span class="carousel-control-next-icon"></span>
                </button>
            </div>
        </div>

        <!-- Información del producto -->
        <div class="detalle-info">
            <h1 class="detalle-titulo">@ViewBag.Articulos.titulo</h1>

            <ul class="detalle-lista">
                <li><strong>Vendedor:</strong> @ViewBag.Vendedor</li>
                <li><strong>Precio de salida:</strong> $@ViewBag.Articulos.precio_salida</li>
                <li><strong>Estado:</strong> @ViewBag.Articulos.estado</li>
                <li><strong>Categoría:</strong> @ViewBag.CategoriaNombre</li>
                <li><strong>Finaliza en:</strong> @ViewBag.Fecha</li>
            </ul>

            <div class="detalle-descripcion">
                <h4>Descripción</h4>
                <p>@ViewBag.Articulos.descripcion</p>
            </div>

            <div class="detalle-botones">
                @if (ViewBag.Estado.ToString().Trim() == "Publicado" && ViewBag.Fecha.ToString().Trim() != "Subasta Cerrada")
                {
                    <a asp-controller="Pujas" asp-action="Realizar" asp-route-id="@ViewBag.Articulos.Id" class="btn-detalle azul" id="btn_puja">Realizar Oferta</a>
                    <a asp-controller="Disputas" asp-action="Create" asp-route-articulo_id="@ViewBag.Articulos.Id" asp-route-vendedor_id="@ViewBag.IdVendedor" class="btn-detalle rojo" id="boton_reporte">Reportar</a>

                    @if (ViewBag.CantidadP == 0)
                    {
                        <a href="/Articulos/Edit/@ViewBag.Articulos.Id" class="btn-detalle verde d-none" id="editarBtn">Editar Artículo</a>
                    }
                }

                @if (ViewBag.VerPuja.ToString().Trim() == "Abierto")
                {
                    <a asp-controller="Pujas" asp-action="VerPujas" asp-route-id="@ViewBag.Articulos.Id" class="btn-detalle gris" id="ver_puja">Ver Pujas</a>
                }
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const usuarioId = localStorage.getItem("userId");
            const idVendedor = "@ViewBag.IdVendedor";

            if (usuarioId && usuarioId === idVendedor) {
                document.getElementById("editarBtn")?.classList.remove("d-none");
                document.getElementById("btn_puja")?.classList.add("d-none");
                document.getElementById("boton_reporte")?.classList.add("d-none");
            }
        });
    </script>
}
